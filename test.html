<!doctype html>
<meta charset="utf-8">
<title>Drag-to-Create Bookmarklet (no blob)</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:20px}
  .bm-btn{display:inline-block;padding:10px 14px;background:#0078d7;color:#fff;border-radius:6px;text-decoration:none;cursor:grab}
</style>
<p>Drag the button to your bookmarks bar to create the bookmarklet. If drag fails, click the button to copy the code.</p>
<a id="dragBtn" class="bm-btn" draggable="true" href="#">Drag to bookmarks bar</a>
<script>
const bmCode = "javascript:(()=>{let p=document.getElementById('bmPanel');if(p){p.style.display=p.style.display==='none'?'block':'none';return;}p=document.createElement('div');p.id='bmPanel';p.style.cssText='position:fixed;top:100px;left:100px;width:400px;height:300px;background:#111;border:2px solid #555;z-index:9999999;resize:both;overflow:hidden;font-family:Arial';let h=document.createElement('div');h.style.cssText='height:30px;background:#222;color:#fff;cursor:move;display:flex;align-items:center;justify-content:space-between;padding:0 6px;user-select:none';h.innerHTML=\"<span>CiphAnon Studios Ai Panel Bookmarklet</span><button id='bmHide' style='background:#444;color:#fff;border:none;cursor:pointer'>âœ•</button>\";let f=document.createElement('iframe');f.src='https://ciphanonstudios.github.io/.11/aiPage/duckai.html';f.style.cssText='width:100%;height:calc(100% - 30px);border:none;background:#fff';p.appendChild(h);p.appendChild(f);document.body.appendChild(p);document.getElementById('bmHide').onclick=()=>p.style.display='none';let dx=0,dy=0,drag=false;h.onmousedown=e=>{drag=true;dx=e.clientX-p.offsetLeft;dy=e.clientY-p.offsetTop};document.onmousemove=e=>{if(drag){p.style.left=e.clientX-dx+'px';p.style.top=e.clientY-dy+'px'}};document.onmouseup=()=>drag=false})();";

// Build a small data: URL HTML page containing the bookmarklet link
function makeDataURL(title, code){
  const html = '<!doctype html><meta charset="utf-8"><title>'+title+'</title>'
             +'<a href="'+code.replace(/"/g,'&quot;')+'">'+title+'</a>';
  return 'data:text/html;charset=utf-8,' + encodeURIComponent(html);
}

const dragBtn = document.getElementById('dragBtn');
const dataUrl = makeDataURL('CiphAnon Ai Panel', bmCode);

// Set href so some browsers can drag the link directly
dragBtn.href = dataUrl;

dragBtn.addEventListener('dragstart', (e) => {
  // Provide multiple types; many browsers accept text/uri-list or text/plain
  e.dataTransfer.setData('text/uri-list', dataUrl);
  e.dataTransfer.setData('text/html', '<a href="'+bmCode+'">CiphAnon Ai Panel</a>');
  e.dataTransfer.setData('text/plain', bmCode);
});

dragBtn.addEventListener('click', (e) => {
  e.preventDefault();
  // Copy bookmarklet to clipboard as fallback
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(bmCode).then(()=>alert('Bookmarklet code copied. Create a new bookmark and paste it as the URL.'), ()=>prompt('Copy this code manually:', bmCode));
  } else {
    prompt('Copy this code manually:', bmCode);
  }
});
</script>
